---
title: "Languages and Music Perception"
output: 
  flexdashboard::flex_dashboard:
    storyboard: true
    theme: sandstone
    self_contained: false
---

```{r setup, include=FALSE}
library(flexdashboard)
library(readr)
library(ggplot2)
library(dplyr)
library(lubridate)
library(tidyverse)
library(readxl)
DSEML_results <- read_excel("DSEML results.xlsx")
```

Home {data-orientation=rows}
=====================================================

Row {Data-height = 350}
----------------------------------------------------

### Participants

```{r}
participants = length(DSEML_results$ResponseId)
valueBox(participants, icon = "fas fa-users", color = "#4BC5BA")
```

### Countries

```{r}
countries = n_distinct(DSEML_results$country)
valueBox(countries, icon = "fas fa-plane", color = "#C54B56")
```

### Songs

```{r}
songs <- 12
valueBox(songs, 
         icon = "fas fa-music",
         color =  "#7D4BC5")
```

Column {.tabset}
---------------------------------------------------------
### Main results
```{r}
valence <-
  DSEML_results %>%
    select(c(valence_E_low_1, valence_D_low_1, valence_M_low_1, valence_H_low_1, valence_E_mid_1, valence_D_mid_1, valence_M_mid_1, valence_H_mid_1, valence_E_high_1, valence_D_high_1, valence_M_high_1, valence_H_high_1)) %>%
      pivot_longer(c("valence_E_low_1", "valence_D_low_1",
                     "valence_M_low_1", "valence_H_low_1",
                     "valence_E_mid_1", "valence_D_mid_1",
                     "valence_M_mid_1", "valence_H_mid_1",
                     "valence_E_high_1", "valence_D_high_1",
                     "valence_M_high_1", "valence_H_high_1"),
                   names_to = "Languages",
                   values_to = "values_mean") %>%
        group_by(Languages) %>% 
          summarise(Values = mean(values_mean)) 

valence['Valence_degree'] <- c("high", "low", "mid", "high", "low", "mid", "high", "low", "mid", "high", "low", "mid")

valence$Valence_degree2 <- factor(valence$Valence_degree, levels=c("low", "mid", "high"))

valence[1, 1] = "Dutch"
valence[2, 1] = "Dutch"
valence[3, 1] = "Dutch"
valence[4, 1] = "English"
valence[5, 1] = "English"
valence[6, 1] = "English"
valence[7, 1] = "Hindi"
valence[8, 1] = "Hindi"
valence[9, 1] = "Hindi"
valence[10, 1] = "Mandarin"
valence[11, 1] = "Mandarin"
valence[12, 1] = "Mandarin"

ggplot(valence, aes(fill=Languages, y=Values, x=Valence_degree2)) + 
geom_bar(position="dodge", stat="identity") + ggtitle("Average Perceived Valence") +
scale_fill_manual(values=c("#93C54B", "#4BC5BA", "#7D4BC5", "#C54B56")) + labs(x="Valence (according to Spotify)", y="Perceived Valence")
```

### Participants
```{r}
ggplot(DSEML_results, aes(x=age, fill=factor(gender))) +
  geom_histogram(color='black', alpha=1) + labs(fill='Gender', title = "Distribution of age and gender of participants") +  scale_fill_manual(name="Gender",labels=c("Male", "Female", "Non-binary", "Other"), values = c("red", "blue", "green", "purple")) + labs(x="Age", y="Number of Participants")
```

### Countries
Map with number of participants per country
```{r}
```


### Songs
Example of experiment with song snippet:

<iframe src="https://open.spotify.com/embed/track/7BYMjh3vWnHU4IFyfZdIDO?utm_source=generator" width="100%" height="80" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"></iframe>


Column {.sidebar data-width=350}
--------------------------------------------------

### Introduction
Last year’s Spotify Wrapped revealed that the top three globally most streamed artists are, in correct order: Bad Bunny, Taylor Swift and BTS (Spotify, 2021). Interestingly, not only are all three artists based in different continents, two of these artists also do not predominantly perform in the English language. Given that more than half of Spotify’s monthly active users come from Western English-speaking countries (Dean, 2021), this goes to show that music indeed transcends language, such that people all around the world can enjoy songs in foreign languages. The question remains, however, how differently do people perceive songs in a non-native language compared to songs in their native language?

Taking advantage of the research group’s diverse cultural backgrounds, an online experiment was designed to investigate the effect of one’s native language on the perception of mood in songs. Native Dutch, Mandarin, Hindi and English speakers were the target populations of this study. For each language, 3 songs were selected according to the valence endpoint values of Spotify API - one with low valence (0.2), one with middle valence (0.5) and one with high valence (0.8). Songs with low valence values represented songs with a sad mood, whereas songs with high valence values represented songs with a happy mood. Songs with middle valence values represented neutral songs that are neither sad nor happy. In total, 12 songs were selected for the experiment. Participants were exposed to 15-second snippets of all 12 songs and rated their perception of the mood (positive vs negative) in the songs.


Valence {data-navmenu=Results}
===============================================

Column
-----------------------------------------------------------------------

### An explanation of Valence
Valence is a rating that is given by sound engineers at Spotify which measures the positiveness of a song. High valence values indicate that a song is happier in nature, while now valence indicates sadder songs. To measure the “happiness” of a song, spotify data scientists have an agreed upon metric of what happy music sounds like. However according to Spotify a large amount of this measurement is also done by AI technology; therefore making it unclear exactly what the indicators of a happy song are. Spotify issues a measurement of valence in a decimal system, with values between 0 to 1 going up to three decimal points. 

Psychologists on the other hand measure valence as the probability of a thing making people experience positive emotions.


### Findings
On the right, the perceived valences of native speakers are compared to those of non-native speakers as well as the total perceived valence. It can be seen that in general:
* Although, most tracks are rated similar to their assigned valence values, there is not a major jump seen between valence
* Hindi music is consistently rated high in perceived valence regardless of its assigned numerical rating on Spotify

In term of non-native compared to native speakers, it can be seen that:
* In general, there is not a clear distinction between natives and non-natives
* 


Column {.tabset}
-----------------------------------------------------------------------

### Dutch Valence
```{r}
Dutch_part <- filter(DSEML_results, dutch != 4, dutch != 3, dutch !=2, dutch != 1) %>%
  select(c(valence_D_low_1, valence_D_mid_1, valence_D_high_1)) %>%
    pivot_longer(c("valence_D_low_1", "valence_D_mid_1", "valence_D_high_1"),
                 names_to = "Languages",
                 values_to = "values_mean") %>%
  group_by(Languages) %>% 
  summarise(Values = mean(values_mean))
Non_Dutch_part <- filter(DSEML_results, dutch !=5, dutch!=6) %>%
  select(c(valence_D_low_1, valence_D_mid_1, valence_D_high_1)) %>%
  pivot_longer(c("valence_D_low_1", "valence_D_mid_1", "valence_D_high_1"),
               names_to = "Languages",
               values_to = "values_mean") %>%
  group_by(Languages) %>% 
  summarise(Values = mean(values_mean))
Dutch_graph = rbind(Dutch_part, Non_Dutch_part)
Dutch_graph['Valence_degree'] <- c("high", "low", "mid", "high", "low", "mid")

Dutch_graph$Valence_degree2 <- factor(Dutch_graph$Valence_degree, levels=c("low", "mid", "high"))

Dutch_graph[1, 1] = "Native"
Dutch_graph[2, 1] = "Native"
Dutch_graph[3, 1] = "Native"
Dutch_graph[4, 1] = "Non-native"
Dutch_graph[5, 1] = "Non-native"
Dutch_graph[6, 1] = "Non-native"

ggplot(Dutch_graph, aes(fill=Languages, y=Values, x=Valence_degree2)) + 
geom_bar(position="dodge", stat="identity") + ggtitle("Dutch Valence") +
scale_fill_manual(values=c("#93C54B", "#121909")) + labs(x="Valence (according to Spotify)", y="Perceived Valence")
```

### English Valence
```{r}
English_part <- filter(DSEML_results, english != 4, english != 3, english !=2, english != 1) %>%
  select(c(valence_E_low_1, valence_E_mid_1, valence_E_high_1)) %>%
    pivot_longer(c("valence_E_low_1", "valence_E_mid_1", "valence_E_high_1"),
                 names_to = "Languages",
                 values_to = "values_mean") %>%
  group_by(Languages) %>% 
  summarise(Values = mean(values_mean))
Non_English_part <- filter(DSEML_results, english !=5, english !=6) %>%
  select(c(valence_E_low_1, valence_E_mid_1, valence_E_high_1)) %>%
  pivot_longer(c("valence_E_low_1", "valence_E_mid_1", "valence_E_high_1"),
               names_to = "Languages",
               values_to = "values_mean") %>%
  group_by(Languages) %>% 
  summarise(Values = mean(values_mean))

English_graph = rbind(English_part, Non_English_part)
English_graph['Valence_degree'] <- c("high", "low", "mid", "high", "low", "mid")

English_graph$Valence_degree2 <- factor(English_graph$Valence_degree, levels=c("low", "mid", "high"))

English_graph[1, 1] = "Native"
English_graph[2, 1] = "Native"
English_graph[3, 1] = "Native"
English_graph[4, 1] = "Non-native"
English_graph[5, 1] = "Non-native"
English_graph[6, 1] = "Non-native"
ggplot(English_graph, aes(fill=Languages, y=Values, x=Valence_degree2)) + 
geom_bar(position="dodge", stat="identity") + ggtitle("English Valence") +
scale_fill_manual(values=c("#4BC5BA", "#091917")) + labs(x="Valence (according to Spotify)", y="Perceived Valence")
```

### Hindi Valence
```{r}
Hindi_part <- filter(DSEML_results, hindi != 4, hindi != 3, hindi !=2, hindi != 1) %>%
  select(c(valence_H_low_1, valence_H_mid_1, valence_H_high_1)) %>%
    pivot_longer(c("valence_H_low_1", "valence_H_mid_1", "valence_H_high_1"),
                 names_to = "Languages",
                 values_to = "values_mean") %>%
  group_by(Languages) %>% 
  summarise(Values = mean(values_mean))
Non_Hindi_part <- filter(DSEML_results, hindi !=5, hindi !=6) %>%
  select(c(valence_H_low_1, valence_H_mid_1, valence_H_high_1)) %>%
  pivot_longer(c("valence_H_low_1", "valence_H_mid_1", "valence_H_high_1"),
               names_to = "Languages",
               values_to = "values_mean") %>%
  group_by(Languages) %>% 
  summarise(Values = mean(values_mean))
Hindi_graph = rbind(Hindi_part, Non_Hindi_part)
Hindi_graph['Valence_degree'] <- c("high", "low", "mid", "high", "low", "mid")

Hindi_graph$Valence_degree2 <- factor(Hindi_graph$Valence_degree, levels=c("low", "mid", "high"))

Hindi_graph[1, 1] = "Native"
Hindi_graph[2, 1] = "Native"
Hindi_graph[3, 1] = "Native"
Hindi_graph[4, 1] = "Non-native"
Hindi_graph[5, 1] = "Non-native"
Hindi_graph[6, 1] = "Non-native"
ggplot(Hindi_graph, aes(fill=Languages, y=Values, x=Valence_degree2)) + 
geom_bar(position="dodge", stat="identity") + ggtitle("Hindi Valence") +
scale_fill_manual(values=c("#7D4BC5", "#100919")) + labs(x="Valence (according to Spotify)", y="Perceived Valence")
```

### Mandarin Valence
```{r}
Mand_part <- filter(DSEML_results, mandarin != 4, mandarin != 3, mandarin !=2, mandarin != 1) %>%
  select(c(valence_M_low_1, valence_M_mid_1, valence_M_high_1)) %>%
    pivot_longer(c("valence_M_low_1", "valence_M_mid_1", "valence_M_high_1"),
                 names_to = "Languages",
                 values_to = "values_mean") %>%
  group_by(Languages) %>% 
  summarise(Values = mean(values_mean))
Non_Mand_part <- filter(DSEML_results, mandarin !=5, mandarin!=6) %>%
  select(c(valence_M_low_1, valence_M_mid_1, valence_M_high_1)) %>%
  pivot_longer(c("valence_M_low_1", "valence_M_mid_1", "valence_M_high_1"),
               names_to = "Languages",
               values_to = "values_mean") %>%
  group_by(Languages) %>% 
  summarise(Values = mean(values_mean))
Mand_graph = rbind(Mand_part, Non_Mand_part)
Mand_graph['Valence_degree'] <- c("high", "low", "mid", "high", "low", "mid")

Mand_graph$Valence_degree2 <- factor(Mand_graph$Valence_degree, levels=c("low", "mid", "high"))

Mand_graph[1, 1] = "Native"
Mand_graph[2, 1] = "Native"
Mand_graph[3, 1] = "Native"
Mand_graph[4, 1] = "Non-native"
Mand_graph[5, 1] = "Non-native"
Mand_graph[6, 1] = "Non-native"
ggplot(Mand_graph, aes(fill=Languages, y=Values, x=Valence_degree2)) + 
geom_bar(position="dodge", stat="identity") + ggtitle("Mand Valence") +
scale_fill_manual(values=c("#C54B56", "#19090B")) + labs(x="Valence (according to Spotify)", y="Perceived Valence")
```

### Averaged Perceived Valence
```{r}
ggplot(valence, aes(fill=Languages, y=Values, x=Valence_degree2)) + 
geom_bar(position="dodge", stat="identity") + ggtitle("Average Perceived Valence") +
scale_fill_manual(values=c("#93C54B", "#4BC5BA", "#7D4BC5", "#C54B56")) + labs(x="Valence (according to Spotify)", y="Perceived Valence")
```


Participants {data-navmenu=Results}
=============================================================

Column {.tabset}
----------------------------------------------------

### Language distribution

```{r}
Dutch = length(which(DSEML_results$dutch == 5)) + length(which(DSEML_results$dutch == 6))
English = length(which(DSEML_results$english == 5)) + length(which(DSEML_results$english == 6))
Hindi = length(which(DSEML_results$hindi == 5)) + length(which(DSEML_results$hindi == 6))
Mandarin = length(which(DSEML_results$mandarin == 5)) + length(which(DSEML_results$mandarin == 6))
filtering_other <- filter(DSEML_results, dutch != 5, dutch != 6, english != 5, english != 6, hindi != 5, hindi != 6, mandarin !=5, mandarin != 6)
Other = length(filtering_other$dutch)
pie_chart <- data.frame("languages" = c('Dutch', 'English', 'Mandarin', 'Hindi', 'Other'), "amount" = c(Dutch, English, Mandarin, Hindi, Other))
ggplot(pie_chart, aes(x="", y=amount, fill=languages)) +
  geom_bar(stat="identity", width=1) +
  coord_polar("y", start=0) + geom_text(aes(label = paste0(amount)), position = position_stack(vjust=0.5)) +
  labs(x = NULL, y = NULL, fill = NULL) +
scale_fill_manual(values=c("#93C54B", "#4BC5BA", "#7D4BC5", "#C54B56", "#656766"))
```

Column
-------------------------------------------------------

### Explanation of pie chart

#### Figure Language Distribution
The distribution of participants who have at least full professional proficiency in the languages tested in the experiment. 

Note. Bilingual participants were counted multiple times. Participants in “Other” did not have at least full professional proficiency in any of the languages. 

Enjoy {data-navmenu=Results}
====================================================
```{r}
lik_fam <- data.frame(
  familiar = c(mean(DSEML_results$familiar_E_low),               mean(DSEML_results$familiar_E_mid), 
mean(DSEML_results$familiar_E_high),
mean(DSEML_results$familiar_D_low),
mean(DSEML_results$familiar_D_mid),
mean(DSEML_results$familiar_D_high),
mean(DSEML_results$familiar_H_low),
mean(DSEML_results$familiar_H_mid),
mean(DSEML_results$familiar_H_high),
mean(DSEML_results$familiar_M_low),
mean(DSEML_results$familiar_M_mid),
mean(DSEML_results$familiar_M_high)),
  enjoyable = c(mean(DSEML_results$enjoy_E_low),
                  mean(DSEML_results$enjoy_E_mid),
                  mean(DSEML_results$enjoy_E_high),
                  mean(DSEML_results$enjoy_D_low),
                  mean(DSEML_results$enjoy_D_mid),
                  mean(DSEML_results$enjoy_D_high),
                  mean(DSEML_results$enjoy_H_low),
                  mean(DSEML_results$enjoy_H_mid),
                  mean(DSEML_results$enjoy_H_high),
                  mean(DSEML_results$enjoy_M_low),
                  mean(DSEML_results$enjoy_M_mid),
                  mean(DSEML_results$enjoy_M_high)),
  language = c("English", "English", "English", "Dutch", "Dutch","Dutch","Hindi", "Hindi","Hindi", "Mandarin", "Mandarin", "Mandarin"),
  valence = c(0.206, 0.571, 0.802, 0.206, 0.571, 0.802, 0.206, 0.571, 0.802, 0.206, 0.571, 0.800)
  )

ggplot(lik_fam, aes(x=familiar, y=enjoyable, size = valence, color = language)) +
    geom_point(alpha=0.5) +
    scale_size(range = c(3, 12), name="Valence") +
  scale_fill_manual(values=c("#4BC5BA", "#7D4BC5", "#C54B56", "#93C54B")) + labs(x="Average Familiarity of the Song", y="Average Enjoyability of the Song")
```

Songs
===============================================
Column {.sidebar data-width=300}
---------------------------------------------------
### Selection process
Due to the difficulty in directly comparing valence with the happiness, we resorted to selecting 3 levels of valence values (low, mid and high). The songs were chosen from four playlists, one per language, of over 120 songs, to find 4 with the same valence. Then we put these 4 songs, and their different levels in a randomized order where participants were asked to rate them in a random order. To minimize sound fatigue and keep respondents alert, we chose to sample 30 seconds of music from each song from its 2nd chorus verse, in order to encapsulate the essence of the various songs. 

Column {data-width=450}
--------------------------------------------------
### Song data
```{r}
Used_songs <- data.frame (
  Title = c("Mojito", "Leef nu het kan", "Walk of life", "Mummy Nu Pasand (From 'Jai Mummy Di')", "Kuan Shu", "Respect", "Don't look back in anger", "Jagga Jiteya", "Ai De Jiu Shi Ni", "Treur niet (Ode aan het leven)", "Maybe tomorrow", "Shubhaarambh"),
  Artist = c("Jay Chou", "Jan Smit", "Dire Straits", "Sunanda Sharma, Tanishjk Bagchi", "Y2j", "Tino Martin", "Oasis", "Daler Mehndi, Dee MC, Shashwat Sachdev", "Leehom Wang", "Diggy Dex, JW Roy", "Stereophonics", "Amit Trivedi, Shruti Pathak, Divya Kumar"),
  Language = c("Mandarin", "Dutch", "English", "Hindi", "Mandarin", "Dutch", "English", "Hindi", "Mandarin", "Dutch", "English", "Hindi"),
  Valence = c(0.800, 0.802, 0.802, 0.802, 0.206, 0.206, 0.206, 0.206, 0.571, 0.571, 0.571, 0.571)
)
knitr::kable(Used_songs)
```
Column {data-width=250}
--------------------------------------------------
<iframe src="https://open.spotify.com/embed/playlist/6iVqkit3KpSl3ixtnvV5k3?utm_source=generator" width="100%" height="380" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"></iframe>